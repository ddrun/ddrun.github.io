<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Redis相关-Interview | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言缓存，谁用谁知道。。。 正文redis数据结构redis数据结构有哪些？大概都适应什么样一个场景？ ======================================================================================&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 常用的数据结构有如下5种：  1、">
<meta name="keywords" content="Interview">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis相关-Interview">
<meta property="og:url" content="http://yoursite.com/2019/03/20/2019-03-20-about Redis/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前言缓存，谁用谁知道。。。 正文redis数据结构redis数据结构有哪些？大概都适应什么样一个场景？ ======================================================================================&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 常用的数据结构有如下5种：  1、">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://ddrun.github.io/img/interview/close-rdb.png">
<meta property="og:image" content="https://ddrun.github.io/img/interview/open-aof.png">
<meta property="og:image" content="https://ddrun.github.io/img/interview/hz.png">
<meta property="og:updated_time" content="2019-04-15T11:27:40.946Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Redis相关-Interview">
<meta name="twitter:description" content="前言缓存，谁用谁知道。。。 正文redis数据结构redis数据结构有哪些？大概都适应什么样一个场景？ ======================================================================================&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 常用的数据结构有如下5种：  1、">
<meta name="twitter:image" content="https://ddrun.github.io/img/interview/close-rdb.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2019-03-20-about Redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/20/2019-03-20-about Redis/" class="article-date">
  <time datetime="2019-03-19T16:00:00.000Z" itemprop="datePublished">2019-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Redis相关-Interview
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><pre><code>缓存，谁用谁知道。。。
</code></pre><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="redis数据结构"><a href="#redis数据结构" class="headerlink" title="redis数据结构"></a>redis数据结构</h3><pre><code>redis数据结构有哪些？大概都适应什么样一个场景？
======================================================================================&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
常用的数据结构有如下5种：
 1、string:字符串，应用于普通的k-v存储；
 2、list:可重复的有序集合，应用场景较多。如：各种列表；
 3、set:不可重复的无序集合，且提供了求交集、并集、差集等方法，应用场景多样。
    如：关注列表、粉丝列表、共同关注、共同喜好等。
 4、sorted set:不可重复的有序集合，在set的基础上加入了分值score。每个成员key在插入时都具有一个score值，
    根据score值进行自动排序。应用场景入入消息权重（普通消息、重要消息）
 5、hash:哈希，存储hashmap、对象等类型数据。如：用户信息、会话信息、常见k-v结构数据等。
</code></pre><h3 id="redis持久化"><a href="#redis持久化" class="headerlink" title="redis持久化"></a>redis持久化</h3><pre><code>redis持久化有哪些方式？有什么区别？你们采用的是哪种方式？
======================================================================================&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
redis持久化，即将数据保存到硬盘。redis的持久化操作有两种，一种RDB（快照）,另一种是AOF（追加到文件）。
（1）RDB是条件触发模式，如果条件不满足则不会触发持久化操作，容易丢失数据。AOF是将数据保存在file文件的末
    尾，不会丢失数据。
（2）RDB是默认持久化模式，可手动关闭。AOF默认关闭，可手动开启。两种方式可同时存在，但redis重启后会优先从
    AOF中重建数据。

    关闭RDB方式如下：
</code></pre><p>   <img src="https://ddrun.github.io/img/interview/close-rdb.png" alt="avatar"></p>
<pre><code>开启AOF方式如下:
</code></pre><p>   <img src="https://ddrun.github.io/img/interview/open-aof.png" alt="avatar"></p>
<pre><code>我们项目中采用的是RDB+AOF方式，先考虑将RDB方式去除。。。
</code></pre><h3 id="redis淘汰机制"><a href="#redis淘汰机制" class="headerlink" title="redis淘汰机制"></a>redis淘汰机制</h3><pre><code>redis的淘汰机制是什么样的？
======================================================================================&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
使用redis过程中，当redis内存暂用量超过设定大小maxmemory，则会根据策略（淘汰机制）去删除符合条件的键值。
在redis的配置文件redis.conf中配置maxmemory-policy即可，具体策略如下：
（1）no-eviction:不淘汰
    redis默认的淘汰策略，不淘汰数据，即内存使用超过阈值时，所有引起申请内存的命令（如写操作）都会报错。
（2）allkeys-lru:最近最少使用all-keys-Least Recently Used
    在主键空间中，移除最近最少使用的key。
（3）allkeys-random:随机删除
    在主键空间中，随机移除key。
（4）volatile-lru
    在设置了过期时间的键空间中，移除最近最少使用的key。
（5）volatile-random
    在设置了过期时间的键空间中，随机移除key。
（6）volatile-ttl:生存时间volatile-Time to Live
     在设置了过期时间的键空间中，移除更早过期的key。

PS：
（1）主键空间和设置过期时间的键空间
    所有的redis中的键值都会存储于一个hash表中，当这些键值中有一部分设置了过期时间，在设置了过期时间的
    键值还存储到另一个hash表中，则设置过期时间的键空间可以看做是主键空间的子集。       
（2）从上述策略中，redis提供的淘汰策略大概分为三种，一是noeviction，不进行淘汰，直接报错；二是allkeys
    在主键空间淘汰数据；三是volatile，在设置了过期时间的键空间中淘汰key。
</code></pre><h3 id="redis数据删除"><a href="#redis数据删除" class="headerlink" title="redis数据删除"></a>redis数据删除</h3><pre><code>redis数据过期后，会立即删除吗？按照什么方式删除？
======================================================================================&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
redis数据在设置了过期时间后，会基于redis过期键删除策略进行数据删除。删除策略有以下几种：
（1）立即删除
    key过期后立即将其删除，及时释放内存，但对cpu资源使用不友好；
（2）定时删除
    key过期后不会立即清除，redis会定时检查，主动的将过期key进行删除；

    PS:
    定时删除策略原理简述
        基于redis的时间事件来实现，redis.c/serverCron即为redis的定时任务，redis3.0默认执行
    频率为10次/s，可通过修改redis.conf中的hz选型来调整执行频率（如下图所示）。该定时任务处理的工作
    其实有很多，删除过期key只是其众多工作中的一项。
        key清理在redis.c/activeExpireCyle函数中实现。过期key定时删除即基于redis定时任务serverCorn,
    定时调用清理函数activeExpireCyle，将过期key进行删除。
</code></pre><p>   <img src="https://ddrun.github.io/img/interview/hz.png" alt="avatar"></p>
<pre><code>（3）惰性删除（被动删除）
    key过期后不会立即删除，当下次操作该过期key时会触发惰性删除将其删除；此策略对内存资源不友好；

redis使用的过期key删除策略是惰性删除加个定时删除，两者配合使用。
</code></pre><h3 id="redis集群处理"><a href="#redis集群处理" class="headerlink" title="redis集群处理"></a>redis集群处理</h3><pre><code>redis有做集群处理吗？采用的什么集群方式？
======================================================================================&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
redis集群实现的技术基础是分片或者分区，即将数据分割到不通redis实例中，每个redis实例只保留全部数据
的一个子集。我的理解中大概可分为三种模式：客户端分片、服务端分片、基于代理的分片。
    1 客户端分片：如jedis客户端等
由客户端决定数据的写入或读取的节点；需要客户端来实现分片、路由、扩容等处理。
    2 服务端分片：如redis-cluster官方方案
由服务端决定数据写入或读取的节点；服务端和客户端都需要相应的处理，服务端官方方案教程较详细，非常容易
搭建，客户端改造在大部分的框架sdk中也基本都有相应的集成。
    3 基于代理的分片：如codis\twemproxy等
由中间件proxy决定数据写入或读取的节点，服务端和客户端都相对独立，集群分片等处理由中间件完成。

    我们采用的是redis-cluster方案，搭建redis集群过程、redis-cluster原理后续会有文章进行详细介绍。
</code></pre><p>   <a href="https://ddrun.github.io/2019/03/20/about-Redis/" target="_blank">搭建redis-cluster集群</a><br>   <a href="https://ddrun.github.io/2019/03/20/about-Redis/" target="_blank">redis-cluster原理机制</a></p>
<h3 id="redis数据一致性"><a href="#redis数据一致性" class="headerlink" title="redis数据一致性"></a>redis数据一致性</h3><pre><code>项目中redis数据一致性问题有碰到过吗？做了哪些处理？
======================================================================================&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
项目中经常为了减少DB压力或提高查询效率，会将某些数据放到redis中，读取的时候优先从redis中获取，但是
因为数据库和redis无法做到强一致性，所以肯定会碰到数据不一致的问题。

数据不一致的原因有很多，如数据库事务回滚，redis数据已变更却无法回滚；redis未及时同步数据库数据的变
更等都会导致数据的不一致；一般的做法是保存数据到DB，同步数据到redis，且在读、写、同步等处理上都有
相应策略。
    读：先查redis，数据miss则查询db，并将数据同步到redis。
    写：写DB，不写redis。
    更新：更新DB,失效现有redis数据，再异步同步数据到redis。
上述写数据的时候一般不会立即同步到redis，避免事务回滚和高并发写入数据产生的脏数据。

    数据库和redis之间没有绝对的强一致性，只有数据的最终一致性。
    在我们的项目中也存在数据一致性问题，我们在按照上述处理规范下，有专门的服务来维护DB与redis的数据
一致性。
</code></pre><h3 id="缓存击穿-缓存雪崩"><a href="#缓存击穿-缓存雪崩" class="headerlink" title="缓存击穿-缓存雪崩"></a>缓存击穿-缓存雪崩</h3><pre><code>缓存击穿和缓存雪崩碰到过吗？如何处理？
======================================================================================&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
    缓存击穿（缓存穿透）：恶意请求一个不存在key，大量请求就会转到DB数据库上，导致数据库连接池满，
连接异常等现象。
    解决方案：
        （1）服务限流，安全控制，设置有效拦截机制；
        （2）采用布隆过滤器，访问不存在key的请求直接被过滤；

    缓存雪崩：缓存数据库重启或缓存大面积失效，大量请求就会转到DB数据库上，导致数据库连接异常等现象。
    解决方案：
        （1）调整缓存失效机制，比如对相同类数据设置不同的失效时间，在原有失效基础添加随机值时间；
        （2）某些数据不设置过期时间，基于具体业务设定，需慎用。

     如何处理问题永远都需要根据具体实际情况来分析，没有最好。。。
</code></pre><h3 id="项目中的redis"><a href="#项目中的redis" class="headerlink" title="项目中的redis"></a>项目中的redis</h3><pre><code>你们项目中redis存哪些数据？
======================================================================================&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
项目中引入redis的初衷是为了提高效率，引入之后，哪些数据放在redis、采用哪种结构、什么时候过期、会
产生什么问题等都是需要考虑的问题。
我们在redis中存放了如下几种数据：
    （1）身份令牌access_token，包含用户信息；
    （2）热数据：热点、头条文章，首页服务等；
    （3）配置数据：路由信息、字典数据等；
    （4）临时业务数据：业务临时使用数据。
</code></pre><h3 id="redis原理机制"><a href="#redis原理机制" class="headerlink" title="redis原理机制"></a>redis原理机制</h3><pre><code>对redis内部机制了解吗？比如Redis Cluster模式、哨兵模式、定时任务、事件等的原理了解吗？ 









hexo blog process:
    (1)安装环境：git和node
    (2)安装hexo
        npm install –g hexo-cli
    (3)环境查看：
        git version
        node -v
        hexo version
    (4)新建一个博客md源码的目录，用来存放后续所有的md文章
     D:\myblog
     该目录下可以进行变更目录，此处新增ddrun目录
    (5)初始化
        hexo init ddrun         
    (6)可启动本地服务，查看默认(blog:http://localhost:4000/)
        hexo server  

    (7)使用hexo将博客部署到github上，先安装插件
        npm install hexo-deployer-git  --save

   （8）修改_config.yaml配置文件
        $ vim _config.yml
        deploy:
                  type: git
                  repo: https://github.com/ddrun/ddrun.github.io.git
                  branch: master
                  message:

   （9）
</code></pre><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>   <strong>路漫漫其修远兮 吾将上下而求索</strong></p>
<p>  <a href="mailto:&#x64;&#x2e;&#100;&#106;&#114;&#97;&#x6e;&#64;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;" target="_blank" rel="noopener">&#x64;&#x2e;&#100;&#106;&#114;&#97;&#x6e;&#64;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/20/2019-03-20-about Redis/" data-id="cjui9zsya0006rcqsa669v4oj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Interview/">Interview</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/03/20/2019-03-20-Summary of Interview/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          面试总结
        
      </div>
    </a>
  
  
    <a href="/2019/01/24/2019-01-24-Hello-2019/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2019 is comming</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Interview/">Interview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diary/">diary</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Interview/" style="font-size: 20px;">Interview</a> <a href="/tags/diary/" style="font-size: 10px;">diary</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/20/2019-03-20-Summary of Interview/">面试总结</a>
          </li>
        
          <li>
            <a href="/2019/03/20/2019-03-20-about Redis/">Redis相关-Interview</a>
          </li>
        
          <li>
            <a href="/2019/01/24/2019-01-24-Hello-2019/">2019 is comming</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>